# Generated by GithubCopilot
"""
Asistente de PlanificaciÃ³n de Viajes ğŸ—ºï¸ CLI entry point.

Recoge las preferencias del usuario por consola, ejecuta el grafo de
planificaciÃ³n (LangGraph) y muestra el itinerario resultante.

Security: input is validated inside the graph (Node 1).
Accessibility: clear prompts with default values in parentheses.
"""

from __future__ import annotations

import logging
import os
import sys

from dotenv import load_dotenv

# Load .env before any other import that may need API keys
load_dotenv()

from graph import run_graph  # noqa: E402


def _setup_logging() -> None:
    """Configure basic logging to stderr."""
    logging.basicConfig(
        level=logging.INFO,
        format="%(asctime)s [%(levelname)s] %(name)s â€” %(message)s",
        stream=sys.stderr,
    )


def _prompt(label: str, default: str = "") -> str:
    """Display a prompt with an optional default value."""
    suffix = f" [{default}]" if default else ""
    value = input(f"{label}{suffix}: ").strip()
    return value or default


def main() -> None:
    """Interactive CLI flow."""
    _setup_logging()

    # Verify API key is present
    if not os.getenv("OPENAI_API_KEY"):
        print(
            "âŒ Error: OPENAI_API_KEY no encontrada.\n"
            "   Crea un archivo .env basÃ¡ndote en .env.example y establece tu clave.",
            file=sys.stderr,
        )
        sys.exit(1)

    print("=" * 60)
    print("  ğŸ—ºï¸  Asistente de PlanificaciÃ³n de Viajes")
    print("=" * 60)
    print()

    destination = _prompt("Destino deseado (ej. Tokio, JapÃ³n)")
    budget = _prompt("Presupuesto (bajo / medio / alto)", "medio")
    trip_type = _prompt("Tipo de viaje (aventura / relax / cultural / familiar)", "cultural")

    duration_str = _prompt("DuraciÃ³n en dÃ­as", "5")
    try:
        duration = int(duration_str)
    except ValueError:
        print("âš ï¸  DuraciÃ³n no vÃ¡lida; se usarÃ¡ 5 dÃ­as.", file=sys.stderr)
        duration = 5

    print()
    print("ğŸ” Generando tu plan de viaje personalizadoğŸ‰")
    print("   (esto puede tardar ~30-60 segundos)")
    print()

    result = run_graph(
        destination=destination,
        budget=budget,
        trip_type=trip_type,
        duration=duration,
    )

    # Display result
    if result.get("validated"):
        print(result.get("final_itinerary", "Sin itinerario generado."))
        print("Aqui tiene su plan de viaje!!")
    else:
        print("âŒ  No se pudo generar el itinerario:")
        for err in result.get("validation_errors", []):
            print(f"   âœ– {err}")
        sys.exit(1)


if __name__ == "__main__":
    main()
